---
layout: default
title: Buzzers
---

<center>
<div id="buzzer-primary" style="width: 100%; font-size: 100px;">Loading</div>
<div id="buzzer-secondary" style="width: 100%; font-size: 40px;">Please wait...</div>
<input id="buzzer-input" type="text">
<table id="buzzer-names" style="padding-top: 5em;"><tr><th colspan="2">Buzzer Names</th></tr></table>
</center>
<div style="position: absolute; right: 0; top: 0;">
    <audio id="buzzer-sound" preload="auto">
        <source src="ding.mp3" type="audio/mpeg">
        <source src="ding.wav" type="audio/x-wav">
        <source src="ding.ogg" type="audio/ogg">
    </audio>
    <span id="buzzer-debug">Debug</span>
</div>
<script>
window.onload = function() {
var nameFields = new Array();
var presses = new Array();
var enabled = false;
var timer = -1;
var timerId = 0;
var primary = document.getElementById("buzzer-primary");
var secondary = document.getElementById("buzzer-secondary");
var input = document.getElementById("buzzer-input");
var lastKeyCode = null;
var sound = document.getElementById("buzzer-sound");

var nameContainer = document.getElementById("buzzer-names");
for (var i = 1; i <= 10; i++) {
    var row = document.createElement("tr");
    row.innerHTML = "<td>Buzzer #" + i + "</td>";
    
    var field = document.createElement("input");
    field.value = "Buzzer #" + i;
    nameFields[i] = field;
    
    var fieldCell = document.createElement("td");
    fieldCell.appendChild(field);
    row.appendChild(fieldCell);
    nameContainer.appendChild(row);
}

function buzzer(key) {
    if (!enabled) {
        return;
    }
    enabled = false;
    primary.innerHTML = nameFields[key].value;
    sound.currentTime = 0;
    sound.play();
    timer = 5;
    updateTimer();
}
function updateTimer() {
    if (timer < 0) {
        enable();
        return;
    } else if (timer == 0) {
        secondary.innerHTML = "STOP";
    } else {
        secondary.innerHTML = "" + timer;
    }
    timer--;
    timerId = window.setTimeout(updateTimer, 1000);
}
function reset() {
    timer = 0;
    window.clearTimeout(timerId);
    sound.pause();
}
function enable() {
    reset();
    enabled = true;
    primary.innerHTML = "Ready";
    secondary.innerHTML = "Press a buzzer";
    input.placeholder = "";
}
function disable() {
    reset();
    enabled = false;
    primary.innerHTML = "Disabled";
    secondary.innerHTML = "Click the space below to start";
    input.placeholder = "Click here to start";
}
disable();

input.onfocus = enable;
input.onblur = disable;
input.onkeydown = function(event) {
    if (!enabled) {
        return;
    }
    var key = event.keyCode;
    if (presses[key]) {
        return;
    }
    presses[key] = true;
    lastKeyCode = null;
    var pressed;
    if (key >= 48 && key <= 57) {
        pressed = key - 48;
        document.getElementById("buzzer-debug").innerHTML = "true";
    } else if (key >= 96 && key <= 105) {
        pressed = key - 96;
        document.getElementById("buzzer-debug").innerHTML = "false";
    } else {
        lastKeyCode = key;
        document.getElementById("buzzer-debug").innerHTML = "null";
        return;
    }
    if (pressed == 0) {
        pressed = 10;
    }
    buzzer(pressed);
}
input.onkeypress = function(event) {
    event.preventDefault();
    if (lastKeyCode != null) {
        var c;
        if (event.which == null) {
            c = String.fromCharCode(event.keyCode);
        } else if (event.which!=0 && event.charCode != 0) {
            c = String.fromCharCode(event.which);
        } else {
    	    return;
        }
        alert("Unknown key: keyCode=" + lastKeyCode + " character='" + c + "'");
        lastKeyCode = null;
    }
}
input.onkeyup = function(event) {
    presses[event.keyCode] = false;
}
};
</script>
